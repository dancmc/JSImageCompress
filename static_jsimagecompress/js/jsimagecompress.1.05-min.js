function ImageCompressor(){function a(a,b){return void 0!==a?a:b}function b(a,b,c){var d=a;switch(c&&(d=3*(a-22)/4),b.toLowerCase()){case"b":return d;case"kb":return d/1024;case"mb":return d/1024/1024}}function c(c,d,e){var f=c.length,g=[],h=(new Date).getTime();c.forEach(function(c){var i=new FileReader,j=new Image,k=c.type;j.onload=function(){var i=a(d.maxWidth,99999),l=a(d.maxHeight,99999),m=a(d.maxSize,999),n=Math.max(a(d.minQuality,10)/100,.1),o=a(d.speed,4),p=a(d.log,!0),q=a(d.resize,!1),r=a(d.units,"MB"),s=a(d.adaptive,!1),t=document.createElement("CANVAS"),u=.9,v=Math.max((.9-n)/o,.05),w=.1,x=Math.min(Math.min(i/j.width,l/j.height),1),y=.9;t.width=j.width*x,t.height=j.height*x;var z=t.getContext("2d");z.drawImage(j,0,0,t.width,t.height);var A=t.toDataURL("image/jpeg",u),B=b(c.size,"mb",!1),C=b(A.length,"mb",!0);for(s&&C>20*m?v=.9-n:s&&C>10*m&&(v=.4);C>m&&u>n;)u-=v,A=t.toDataURL("image/jpeg",u),C=b(A.length,"mb",!0);for(s&&C>3*m&&(y=.7,w=.15);C>m&&q&&y>.1;){for(t.width=j.width*x*y,t.height=j.height*x*y,u=1,z.drawImage(j,0,0,t.width,t.height);C>m&&u>n;)u-=v,A=t.toDataURL("image/jpeg",u),C=b(A.length,"mb",!0);y-=w}var D=(new Date).getTime()-h;h=(new Date).getTime(),p&&console.log("For "+c.name+", took "+D+"ms, size is "+b(A.length,r,!0).toFixed(3)+" "+r),g.push({dataurl:A,filename:c.name,mime:k,originalSize:b(c.size,r,!1),finalSize:b(A.length,r,!0),compression:parseFloat((100*(1-C/B)).toFixed(2)),time:D,originalWidth:j.width,originalHeight:j.height,finalWidth:t.width,finalHeight:t.height}),g.length===f&&(g=g.filter(function(a){return null!==a}),e(g))},j.onerror=function(){console.log(c.name+" is not a supported image format."),g.push(null)},i.onload=function(a){j.src=a.target.result},i.readAsDataURL(c)})}function d(a,b,d){c(a,b,function(a){a.forEach(function(a){a.blob=e(a.dataurl),delete a.dataurl}),d(a)})}function e(a){for(var b=a.split(","),c=b[0].match(/:(.*?);/)[1],d=atob(b[1]),e=d.length,f=new Uint8Array(e);e--;)f[e]=d.charCodeAt(e);return new Blob([f],{type:c})}function f(a){try{return a.split(",")[1]}catch(b){return a}}this.defaultFor=a,this.formatSize=b,this.imagesToResizedDataUrls=c,this.imagesToResizedBlobs=d,this.dataUrlToBlob=e,this.base64StringFromDataUrl=f}